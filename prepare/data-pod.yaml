---
apiVersion: v1
kind: Pod
metadata:
  labels:
    run: data-pod
  name: data-pod
spec:
  imagePullSecrets:
  - name: dockerregcred
  initContainers:
  - name: iam-init
    image: ergon/airlock-iam:latest-7.3
    imagePullPolicy: IfNotPresent
    command:
    - bash
    - -c
    - |
      if [ ! -d /home/airlock/iam/instances ]; then
        /iam_entrypoint init
      fi
    volumeMounts:
    - name: data
      mountPath: /home/airlock/iam/
      subPath: iam
  containers:
  - name: data-container
    image: alpine
    imagePullPolicy: IfNotPresent
    command:
    - sh
    - -c
    - "--"
    args:
    - |
      while true; do
        sleep 5;
      done;
    volumeMounts:
    - name: data
      mountPath: /data/
  volumes:
  - name: data
    persistentVolumeClaim:
      claimName: data-claim