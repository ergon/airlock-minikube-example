---
apiVersion: v1
kind: Pod
metadata:
  labels:
    run: data-pod
  name: data-pod
spec:
  imagePullSecrets:
  - name: dockerregcred
  initContainers:
  - name: iam-prepare
    image: alpine
    imagePullPolicy: IfNotPresent
    securityContext:
      runAsUser: 0
    command:
    - sh
    - -c
    - "--"
    args: 
    - | 
      rm -rf /data/iam
      mkdir -p /data/iam
      chown -R 1000:0 /data/iam
    volumeMounts:
    - name: data
      mountPath: /data/
  - name: iam-init
    image: ergon/airlock-iam:latest-7.3
    imagePullPolicy: IfNotPresent
    args: 
    - init
    volumeMounts:
    - name: data
      mountPath: /home/airlock/
  containers:
  - name: data-container
    image: alpine
    imagePullPolicy: IfNotPresent
    command:
    - sh
    - -c
    - "--"
    args:
    - |
      while true; do
        sleep 5;
      done;
    volumeMounts:
    - name: data
      mountPath: /data/
  volumes:
  - name: data
    persistentVolumeClaim:
      claimName: data-claim